<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ú–æ–∏ RSS-–ª–µ–Ω—Ç—ã ‚Äî —Å–ª–æ–≤–∞—Ä—å –Ω–æ–≤–æ—Å—Ç–µ–π</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; }
    .wrap { max-width: 880px; margin: 24px auto; padding: 16px; }
    h1 { margin: 0 0 8px 0; font-size: 1.6rem; }
    p.hint { margin: 0 0 16px 0; color: #888; }
    textarea, input[type="number"], input[type="text"] {
      width: 100%; box-sizing: border-box; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      padding: 10px; border-radius: 10px; border: 1px solid #6663;
      background: transparent; outline: none;
    }
    textarea { min-height: 120px; }
    .row { display: flex; gap: 12px; margin-top: 12px; flex-wrap: wrap; }
    .row > * { flex: 1 1 220px; }
    button {
      border: none; padding: 10px 14px; border-radius: 10px; cursor: pointer; font-weight: 600;
      background: #4f46e5; color: #fff; box-shadow: 0 6px 20px #4f46e53a;
    }
    .footer { margin-top: 18px; color:#888 }
    .muted { color:#888 }
    .format { display:flex; gap:16px; align-items:center; margin-top:6px }
    .out { margin-top:14px }
    .tabs { display:flex; gap:8px; margin-top:8px }
    .tabs button { background:#374151; }
    .tabs button.sel { background:#2563eb; }
    .outbox { white-space: pre-wrap; word-break: break-word; border:1px solid #6663; border-radius:10px; padding:10px; min-height: 120px; }
    code { background: #6661; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>–ú–æ–∏ RSS-–ª–µ–Ω—Ç—ã ‚Üí —Å–ª–æ–≤–∞—Ä—å –Ω–æ–≤–æ—Å—Ç–µ–π</h1>
    <p class="hint">–í—Å—Ç–∞–≤—å—Ç–µ RSS-—Å—Å—ã–ª–∫–∏ (–ø–æ –æ–¥–Ω–æ–π –≤ —Å—Ç—Ä–æ–∫–µ –∏–ª–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é). –í —Ñ–æ—Ä–º–∞—Ç–µ ¬´HTML¬ª –ø–æ–ª—É—á–∞—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∏: –∑–∞–≥–æ–ª–æ–≤–æ–∫-—Å—Å—ã–ª–∫–∞, –¥–∞—Ç–∞ –∏ –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ.</p>

    <textarea id="rssInput" placeholder="https://lenta.ru/rss/news
https://ria.ru/export/rss2/archive/index.xml">https://lenta.ru/rss/news
https://ria.ru/export/rss2/archive/index.xml</textarea>

    <div class="row">
      <div>
        <label>–°–∫–æ–ª—å–∫–æ –±—Ä–∞—Ç—å —Å—Ç–∞—Ç–µ–π –≤ –∫–∞–∂–¥–æ–º –∏–∑ –∫–∞–Ω–∞–ª–æ–≤:
          <input id="latestN" type="number" min="1" max="300" value="100" />
        </label>
      </div>
      <div>
        <label>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (–æ–ø—Ü., —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):
          <input id="keywords" type="text" value="–†–æ—Å—Å–∏—è, —ç–∫–æ–Ω–æ–º–∏–∫–∞, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏" />
        </label>
      </div>
    </div>

    <div class="format">
      <strong>–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:</strong>
      <label><input type="radio" name="fmt" value="json"> JSON</label>
      <label><input type="radio" name="fmt" value="text"> –¢–µ–∫—Å—Ç</label>
      <label><input type="radio" name="fmt" value="html" checked> HTML</label>
      <button id="btnLoad" onclick="fetchRSS()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
      <button id="btnCopy" onclick="copyOut()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>

    <div class="out">
      <div id="outBox" class="outbox" placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –æ—Ç–≤–µ—Ç..."></div>
    </div>

    <div class="footer">
        <br><br>‚ùÑÔ∏èüåµ This project is created by BMSTU Students
    </div>
  </div>

  <script>
    function currentFormat() {
      return document.querySelector('input[name="fmt"]:checked').value;
    }

    async function fetchRSS() {
      const input = document.getElementById('rssInput').value;
      const latestN = Number(document.getElementById('latestN').value) || 100;
      const keywords = (document.getElementById('keywords').value || '')
        .split(',')
        .map(s => s.trim())
        .filter(Boolean);

      const fmt = currentFormat();
      const url = fmt === 'text' ? '/api/rss_text'
                : fmt === 'html' ? '/api/rss_html'
                : '/api/rss';

      const res = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ urls: input, latest_n: latestN, keywords })
      });

      const box = document.getElementById('outBox');

      if (fmt === 'html') {
        const html = await res.text();
        box.innerHTML = html;           // –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–∑ –±—ç–∫–∞
        window.NEWS_DICT = undefined;
      } else if (fmt === 'text') {
        const text = await res.text();
        box.textContent = text;         // plain text
        window.NEWS_DICT = undefined;
      } else {
        const data = await res.json();
        window.NEWS_DICT = data.news || {};
        box.textContent = JSON.stringify(data, null, 2);
      }
    }

    function copyOut() {
      const el = document.getElementById('outBox');
      const range = document.createRange();
      range.selectNodeContents(el);
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
      try { document.execCommand('copy'); } catch {}
      sel.removeAllRanges();
    }

    // –ù–∞ –≤—Å—è–∫–∏–π: –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –º–µ–Ω—è—Ç—å –¥–µ—Ñ–æ–ª—Ç—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
    window.addEventListener('DOMContentLoaded', () => {
      // –º–æ–∂–Ω–æ –ø–æ–¥–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç—Å—é–¥–∞, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è
      // document.getElementById('latestN').value = 100;
      // document.getElementById('keywords').value = "–†–æ—Å—Å–∏—è, —ç–∫–æ–Ω–æ–º–∏–∫–∞, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏";
      // document.getElementById('rssInput').value = `https://lenta.ru/rss/news
      // https://ria.ru/export/rss2/archive/index.xml`;
    });
  </script>
</body>
</html>
