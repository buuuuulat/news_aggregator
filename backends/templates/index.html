<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ú–æ–∏ RSS-–ª–µ–Ω—Ç—ã ‚Äî —Å–ª–æ–≤–∞—Ä—å –Ω–æ–≤–æ—Å—Ç–µ–π</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; }
    .wrap { max-width: 880px; margin: 24px auto; padding: 16px; }
    h1 { margin: 0 0 8px 0; font-size: 1.6rem; }
    p.hint { margin: 0 0 16px 0; color: #888; }
    textarea, input[type="number"], input[type="text"] {
      width: 100%; box-sizing: border-box; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      padding: 10px; border-radius: 10px; border: 1px solid #6663;
      background: transparent; outline: none;
    }
    textarea { min-height: 120px; }
    .row { display: flex; gap: 12px; margin-top: 12px; flex-wrap: wrap; }
    .row > * { flex: 1 1 220px; }
    button {
      border: none; padding: 10px 14px; border-radius: 10px; cursor: pointer; font-weight: 600;
      background: #4f46e5; color: #fff; box-shadow: 0 6px 20px #4f46e53a;
    }
    .footer { margin-top: 18px; color:#888 }
    .muted { color:#888 }
    .format { display:flex; gap:16px; align-items:center; margin-top:6px }
    .out { margin-top:14px }
    .tabs { display:flex; gap:8px; margin-top:8px }
    .tabs button { background:#374151; }
    .tabs button.sel { background:#2563eb; }
    pre { white-space: pre-wrap; word-break: break-word; border:1px solid #6663; border-radius:10px; padding:10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>–ú–æ–∏ RSS-–ª–µ–Ω—Ç—ã ‚Üí —Å–ª–æ–≤–∞—Ä—å –Ω–æ–≤–æ—Å—Ç–µ–π</h1>
    <p class="hint">–í—Å—Ç–∞–≤—å—Ç–µ RSS-—Å—Å—ã–ª–∫–∏ (–ø–æ –æ–¥–Ω–æ–π –≤ —Å—Ç—Ä–æ–∫–µ –∏–ª–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é). –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç ¬´–¢–µ–∫—Å—Ç¬ª, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å —Ç–µ–∫—Å—Ç–æ–º.</p>

    <textarea id="rssInput" placeholder="https://lenta.ru/rss/news
https://ria.ru/export/rss2/archive/index.xml">https://lenta.ru/rss/news
https://ria.ru/export/rss2/archive/index.xml</textarea>

    <div class="row">
      <div>
        <label>–°–∫–æ–ª—å–∫–æ –±—Ä–∞—Ç—å –Ω–∞ –ª–µ–Ω—Ç—É:
          <input id="latestN" type="number" min="1" max="100" value="100" />
        </label>
      </div>
      <div>
        <label>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (–æ–ø—Ü., —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):
          <input id="keywords" type="text" placeholder="–≠–∫–æ–Ω–æ–º–∏–∫–∞, –Ω–∞—É–∫–∞", value="–†–æ—Å—Å–∏—è, —ç–∫–æ–Ω–æ–º–∏–∫–∞, –Ω–∞—É–∫–∞" />
        </label>
      </div>
    </div>

    <div class="format">
      <strong>–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:</strong>
      <label><input type="radio" name="fmt" value="json" checked> JSON</label>
      <label><input type="radio" name="fmt" value="text"> –¢–µ–∫—Å—Ç</label>
      <button id="btnLoad" onclick="fetchRSS()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
      <button id="btnCopy" onclick="copyOut()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>

    <div class="out">
      <pre id="outBox" placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –æ—Ç–≤–µ—Ç..."></pre>
    </div>

    <div class="footer">
        <br><br>ü§ó
    </div>
  </div>

  <script>
    function currentFormat() {
      return document.querySelector('input[name="fmt"]:checked').value;
    }

    async function fetchRSS() {
      const input = document.getElementById('rssInput').value;
      const latestN = Number(document.getElementById('latestN').value) || 10;
      const keywords = (document.getElementById('keywords').value || '')
        .split(',')
        .map(s => s.trim())
        .filter(Boolean);

      const fmt = currentFormat();
      const url = fmt === 'text' ? '/api/rss_text' : '/api/rss';

      const res = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ urls: input, latest_n: latestN, keywords })
      });

      if (fmt === 'text') {
        const text = await res.text();
        document.getElementById('outBox').textContent = text;
        // –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞: –æ—á–∏—Å—Ç–∏–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        window.NEWS_DICT = undefined;
      } else {
        const data = await res.json();
        window.NEWS_DICT = data.news || {};
        document.getElementById('outBox').textContent = JSON.stringify(data, null, 2);
      }
    }

    function copyOut() {
      const el = document.getElementById('outBox');
      const range = document.createRange();
      range.selectNodeContents(el);
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
      try { document.execCommand('copy'); } catch {}
      sel.removeAllRanges();
    }
  </script>
</body>
</html>
