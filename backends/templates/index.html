<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Newwwwws</title>
  <link rel="stylesheet" href="/static/style.css" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
    form { margin-bottom: 20px; }
    .news-item { padding: 10px 0; border-bottom: 1px solid #eee; }
    .meta { font-size: 12px; color: #666; }
    .chips { display: inline-flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    .chip { font-size: 12px; padding: 4px 8px; border: 1px solid #ddd; border-radius: 999px; }
    .empty { color: #999; }
  </style>
</head>
<body>
  <h1>Новости по выбранным источникам</h1>

  <form action="/" method="post">
    <p><strong>Выберите источники:</strong></p>
    {% if sources %}
      {% for src in sources %}
        <div>
          <input
            type="checkbox"
            id="src-{{ src }}"
            name="websites"
            value="{{ src }}"
            {% if src in selected %}checked{% endif %}
          />
          <label for="src-{{ src }}">{{ src }}</label>
        </div>
      {% endfor %}
    {% else %}
      <p class="empty">Источники не найдены. Проверьте файл <code>data/news.jsonl</code>.</p>
    {% endif %}
    <br />
    <button type="submit">Показать новости</button>
  </form>

  {% if selected %}
    <div class="chips">
      <div class="chip">Выбрано: {{ selected | join(", ") }}</div>
    </div>
  {% endif %}

  <hr />

  {% if items and items|length > 0 %}
    <h2>Лента</h2>
    {% for it in items %}
      <div class="news-item">
        <a href="{{ it.url }}" target="_blank" rel="noopener noreferrer">{{ it.title }}</a>
        <div class="meta">
          Источник: {{ it.source }} |
          Опубликовано: {{ (it._dt or "").strftime("%Y-%m-%d %H:%M") if it._dt else "" }}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p class="empty">Выберите источники и нажмите «Показать новости», чтобы увидеть ленту.</p>
  {% endif %}
</body>
</html>
